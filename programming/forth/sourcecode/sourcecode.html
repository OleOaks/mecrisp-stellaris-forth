<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Source Code &mdash; Mecrisp-Stellaris-Forth 0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Source Code" href="analyzesourcecode.html" />
    <link rel="prev" title="Data Structures" href="../datastructures/datastructures.html" />
    <link href="../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Mecrisp-Stellaris-Forth
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/index.html">Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/microcrontrollers/index.html">Microcrontrollers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/index.html">STM32F103C8T6 BluePill</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html">Blue Pill Startup</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html#items-needed-to-get-started">Items needed to get started</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html#things-to-know">Things to know</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html#wire-the-st-link-programmer">Wire the ST-LINK programmer</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html#flash-with-the-stm32cubeprogrammer">Flash with the STM32CubeProgrammer</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html#wire-the-cp2102-usart">Wire the CP2102 USART</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/bluepillstartup.html#setup-serial-console">Setup Serial Console</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/memorymodel.html">Memory Model of the Blue Pill</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/microcrontrollers/bluepill/commoncode.html">Common Code to Flash</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/index.html">STM32F411CEU6 BlackPill</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html">BlackPill Startup</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html#items-needed-to-get-started">Items needed to get started</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html#things-to-know">Things to know</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html#wiring-the-st-link-programmer">Wiring the ST-LINK programmer</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html#flash-with-the-stm32cubeprogrammer">Flash with the STM32CubeProgrammer</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html#wire-the-cp2102-usart">Wire the CP2102 USART</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/blackpillstartup.html#setup-serial-console">Setup Serial Console</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/memorymodel.html">Memory Model of the Blue Pill</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/microcrontrollers/blackpill/commoncode.html">Common Code to Flash</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/optoelectronics/index.html">Optoelectronics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/optoelectronics/leds/index.html">LEDs (Light emitting diodes)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/optoelectronics/leds/leds.html">LEDs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/optoelectronics/displays/index.html">Displays</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/optoelectronics/displays/ssd1306oled.html">SSD1306 OLDED</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/optoelectronics/displays/max7219matrix.html">MAX7219 Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/optoelectronics/displays/max7219sevensegment.html">MAX7219 7-Segment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/integratedcircuits/index.html">Integrated Circuits (ICs)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/integratedcircuits/memory.html">Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/integratedcircuits/clocktiming.html">Clock/Timing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/integratedcircuits/sdcard/index.html">SD-Card</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hardware/integratedcircuits/sdcard/sdcard.html">SD-Cards</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../hardware/integratedcircuits/sdcard/sdcard.html#unfinished">Unfinished…</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../hardware/sensors/index.html">Sensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/sensors/hx711loadcell.html">HX711 Load Cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hardware/sensors/bme280temphumid.html">BME280 Temperature/Humidity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Programming</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Forth</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../forth.html">FORTH Programming Language</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../forth.html#where-to-get-the-software">Where to get the software?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../assembler/assembler.html">Assembler</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../assembler/assembler.html#registers">Registers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../assembler/assembler.html#variable-v-constant">Variable v Constant</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../startup/startup.html">Startup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../startup/startup.html#the-basics">The Basics</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../startup/startup.html#bits">Bits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../memory/memory.html">Memory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../memory/memory.html#the-basics">The Basics</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../memory/memory.html#bits">Bits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../variables/variables.html">Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../variables/variables.html#anatomy-of-a-variable">Anatomy of a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../variables/variables.html#fetch-words">Fetch words</a></li>
<li class="toctree-l4"><a class="reference internal" href="../variables/variables.html#variable-words">Variable Words</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../variables/variables.html#variable">VARIABLE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../variables/variables.html#id1">2VARIABLE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../variables/variables.html#nvariable">NVARIABLE</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../variables/variables.html#appending-words">Appending words</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../variables/variables.html#id2"><code class="docutils literal notranslate"><span class="pre">variable</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../datastructures/datastructures.html">Data Structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../datastructures/datastructures.html#arrays">Arrays</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#array">1ARRAY</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#carray">1CARRAY</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#array-rng">1ARRAY-RNG</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#id1">2ARRAY</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../datastructures/datastructures.html#classes">Classes</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#class">CLASS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#field">FIELD</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#variant">VARIANT</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#start-variants">START-VARIANTS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#end-variant">END-VARIANT</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#end-all-variants">END-ALL-VARIANTS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#insert">INSERT</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#end-class">END-CLASS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#afield">1AFIELD</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#instance">INSTANCE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#m-instance">M-INSTANCE</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../datastructures/datastructures.html#enumerations">Enumerations</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../datastructures/datastructures.html#enum">ENUM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Source Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initial-setup">Initial Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make">Make</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory">Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#changes">Changes</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#flash-size">Flash Size</a></li>
<li class="toctree-l5"><a class="reference internal" href="#greeting">Greeting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analyzesourcecode.html">Source Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general/index.html">General Programming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general/memory.html">Memory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../general/memory.html#the-basics">The Basics</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../general/memory.html#bits">Bits</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../workbench/index.html">Workbench Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../workbench/software/index.html">Software Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/software/stm32cubeprogrammer.html">STM32 Cube Programmer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/stm32cubeprogrammer.html#what-s-this-used-for">What’s this used for?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/stm32cubeprogrammer.html#where-to-get-it">Where to get it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/stm32cubeprogrammer.html#flashing-forth-quicksteps">Flashing Forth Quicksteps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/stm32cubeprogrammer.html#flashing-forth-screenshots">Flashing Forth screenshots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/software/teraterm.html">Tera Term</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/teraterm.html#what-s-this-used-for">What’s this used for?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/teraterm.html#where-to-get-it">Where to get it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/teraterm.html#setup-tera-term-quicksteps">Setup Tera Term Quicksteps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/software/teraterm.html#tera-term-setup-screenshots">Tera Term setup screenshots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/software/vim.html">VIM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../workbench/hardware/index.html">Hardware used in lab</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/hardware/logicanalyzer.html">Logic Analyzer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/hardware/oscilloscope.html">Oscilloscope</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/hardware/breadboard.html">Breadboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/hardware/multimeter.html">Multimeter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/hardware/stlinkv2.html">ST-LINK V2 Programming Dongle</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/hardware/stlinkv2.html#purpose">Purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../workbench/hardware/stlinkv2.html#what-to-buy">What to buy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workbench/hardware/cp2102.html">CP2102 USB to UART</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Mecrisp-Stellaris-Forth</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Programming</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Forth</a></li>
      <li class="breadcrumb-item active">Source Code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/programming/forth/sourcecode/sourcecode.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="source-code">
<h1>Source Code<a class="headerlink" href="#source-code" title="Permalink to this heading"></a></h1>
<p>I was able to compile my own modified version of mecrisp-stellaris-forth from source code. I used Windows Subsystem for Linux (WSL) installed with the arm compiler and make.</p>
<p>Honestly, it’s always felt like black box voodoo and beyond my skills to dabble in the source code and compiling my own version of mecrisp never seemed possible. But, It turned out to be extremely easy to do, and the source files Matthias includes in the forth zip file makes things super simple. The source code is found in the <code class="docutils literal notranslate"><span class="pre">mecrisp-stellaris-source</span></code> folder of the zip file conents. The basic steps are:</p>
<ol class="arabic simple">
<li><p>Make a copy of the <cite>common</cite> folder, put it anywhere convenient.</p></li>
<li><p>Copy the source folder for your specific microcrontroller, keep same relative path to common.</p></li>
<li><p>Make any edits to the source code.</p></li>
<li><p>Open a WSL command window and navigate to your source code folder.</p></li>
<li><p>Run <cite>make</cite> on the WSL command line.</p></li>
<li><p>Done, flash the .bin file to your microcrontroller!</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A super easy way to get a WSL terminal opened at the correct path is to use Windows Explorer. Navigate to the copied source code folder for you microcrontroller using Windows Explorer. Then, in the address bar that shows the full path, replace the text with the word <cite>bash</cite> and hit the enter key. Poof! new WSL window at the correct path!</p>
</div>
<section id="initial-setup">
<h2>Initial Setup<a class="headerlink" href="#initial-setup" title="Permalink to this heading"></a></h2>
<p>If you’ve never used WSL for Windows. Follow some online instructions and install it.</p>
<p>The GNU Arm Embedded Toolchain is required to compile source code into a .bin file for flashing onto an arm microcrontroller.</p>
<p>I used the following linux commands to install the toolchain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$ sudo apt-get update
<span class="linenos">2</span>$ sudo apt remove gcc-arm-none-eabi
<span class="linenos">3</span>$ sudo apt install gcc-arm-none-eabi
</pre></div>
</div>
<p>I believe Make comes installed with WSL, otherwise you may need to install it.</p>
</section>
<hr class="docutils" />
<section id="make">
<h2>Make<a class="headerlink" href="#make" title="Permalink to this heading"></a></h2>
<p>The Makefile for the source code begins compiling with the specfic board.s file, e.g. for the BluePill it’s mecrisp-stellaris-stm32f103.s</p>
<p>Tracing the file calls starting with mecrisp-stellaris-stm32f103.s, this is the call tree…</p>
<ul>
<li><p>mecrisp-stellaris-stm32f103.s</p>
<blockquote>
<div><ul class="simple">
<li><p>datastackandmacros.s</p></li>
</ul>
</div></blockquote>
</li>
<li><p>mecrisp-stellaris-stm32f103.s</p>
<blockquote>
<div><ul>
<li><p>vector.s</p>
<blockquote>
<div><ul class="simple">
<li><p>vectors-common.s</p></li>
</ul>
</div></blockquote>
</li>
<li><p>vector.s</p></li>
</ul>
</div></blockquote>
</li>
<li><p>mecrisip-stellaris-stme32f103.s</p>
<blockquote>
<div><ul>
<li><p>forth-core.s</p>
<blockquote>
<div><ul class="simple">
<li><p>If using registerallocator (RA) ra-infrastructure.s</p></li>
<li><p>If using registerallocater (RA) ra-tools.</p></li>
<li><p>double.s</p></li>
<li><p>stackjugglers.s</p></li>
<li><p>logic.s</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="memory">
<h2>Memory<a class="headerlink" href="#memory" title="Permalink to this heading"></a></h2>
<p>To illustrate the memory layout of forth code, it’s helpful to analyze the source code to find all references to memory.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>mecrisp-stellaris-stm32f103.s</dt><dd><ol class="arabic simple">
<li><p>RamAnfang             0x20000000 ( Start of RAM )</p></li>
<li><p>RamEnde               0x20005000 ( End of RAM )</p></li>
<li><p>Kernshutzadresse      0x20000000 ( Core protection address )</p></li>
<li><p>FlashDictionaryanfang 0x00004000 ( Flash-Dictionary begin )</p></li>
<li><p>FlashDictionaryEnde   0x00010000 ( Flash-Dictionary end )</p></li>
<li><p>Backlinkgrenze        RamAnfang  ( Backlink boundary )</p></li>
<li><p>o</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vector.s</dt><dd><ol class="arabic simple">
<li><p>hidden</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="changes">
<h2>Changes<a class="headerlink" href="#changes" title="Permalink to this heading"></a></h2>
<p>Common changes</p>
<section id="flash-size">
<h3>Flash Size<a class="headerlink" href="#flash-size" title="Permalink to this heading"></a></h3>
<p>After flashing the original pre-compiled .bin file, run the <code class="docutils literal notranslate"><span class="pre">words</span></code> command in forth to see a printout of the core dictionary. i.e. A fresh board flashed with mecrisp-stellaris-forth. Notice the dictionary starts at 00000150 ( after the vector table ) and ends at 00003BAA ( which is why 16 kb reserved, i.e. up to 00004000 ).</p>
<figure class="align-default" id="id1">
<img alt="../../../_images/compiler_rawflash.png" src="../../../_images/compiler_rawflash.png" />
<figcaption>
<p><span class="caption-text"><em>fresh install of original .bin file</em></span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The original source code for the stm32f103 bluepill has 64 kb of memory allocated to flash. 16 kb is reserved for the Mecrisp .bin file. So 64 - 16 = 48 kb remains for flash. The Mecrisp .bin file is written between 0x00000000 and 0x00004000, any code you compile to flash which get added to the dictionary while using the board will start at 0x00004000.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Constants for flash memory size and distribution ( mecrisp-stellaris-stm32f103.s )</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@ Konstanten für die Größe und Aufteilung des Flash-Speichers

.equ Kernschutzadresse,     0x00004000 @ Darunter wird niemals etwas geschrieben ! Mecrisp core never writes flash below this address.
.equ FlashDictionaryAnfang, 0x00004000 @ 16 kb für den Kern reserviert...           16 kb Flash reserved for core.
<span class="hll">.equ FlashDictionaryEnde,   0x00010000 @ 48 kb Platz für das Flash-Dictionary       48 kb Flash available. Porting: Change this !
</span>.equ Backlinkgrenze,        RamAnfang  @ Ab dem Ram-Start.
</pre></div>
</div>
</div>
<p>My bluepill boards have the hidden 64 kb of extra flash, so I want to increase the <code class="docutils literal notranslate"><span class="pre">FlashDictionaryEnde</span></code> variable by an additional 64 kb. The old value of 0x00010000 becomes 0x0002000</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Revised flash memory size code ( mecrisp-stellaris-stm32f103.s )</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@ Konstanten für die Größe und Aufteilung des Flash-Speichers

.equ Kernschutzadresse,     0x00004000 @ Darunter wird niemals etwas geschrieben ! Mecrisp core never writes flash below this address.
.equ FlashDictionaryAnfang, 0x00004000 @ 16 kb für den Kern reserviert...           16 kb Flash reserved for core.
<span class="hll">.equ FlashDictionaryEnde,   0x00020000 @ 112 kb Platz für das Flash-Dictionary     112 kb Flash available. Porting: Change this !
</span>.equ Backlinkgrenze,        RamAnfang  @ Ab dem Ram-Start.
</pre></div>
</div>
</div>
</section>
<section id="greeting">
<h3>Greeting<a class="headerlink" href="#greeting" title="Permalink to this heading"></a></h3>
<p>To remind myself that I’m working with a modified version of mecrisp, I like to change the greeting on startup.</p>
<p>The original:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Original welcome text ( mecrisp-stellaris-stme32f103.s )</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">welcome</span> <span class="s2">&quot; for STM32F103 by Matthias Koch&quot;</span>
</pre></div>
</div>
</div>
<p>Changed to:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Modified welcome text ( mecrisp-stellaris-stm32f103.s )</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">welcome</span> <span class="s2">&quot; for STM32F103 by Matthias Koc, modified by Brett Olson&quot;</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../datastructures/datastructures.html" class="btn btn-neutral float-left" title="Data Structures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="analyzesourcecode.html" class="btn btn-neutral float-right" title="Source Code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Brett Olson, released under the GPL V3. Last updated on May 17, 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>